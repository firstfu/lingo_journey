# 動態島快速翻譯功能設計

## 概述

實現「常駐動態島」功能，讓用戶點擊動態島後自動翻譯剪貼簿內容，結果直接顯示在動態島上。

## 功能需求

- **觸發方式**：點擊動態島
- **輸入來源**：系統剪貼簿
- **語言設定**：使用 App 中上次設定的語言對
- **結果顯示**：直接更新動態島（不開啟 App）
- **常駐模式**：透過設定頁面開關控制

## 核心流程

```
用戶開啟設定開關
       ↓
  動態島常駐顯示（待機狀態）
       ↓
  用戶複製任意文字
       ↓
  點擊動態島
       ↓
  App 讀取剪貼簿 → 使用上次語言設定翻譯
       ↓
  動態島更新顯示翻譯結果
       ↓
  5 秒後恢復待機（等待下次點擊）
```

## 技術實作

### 點擊處理機制

使用 Deep Link (URL Scheme) 處理點擊：

```
lingojourney://translate-clipboard
```

### 需要修改的檔案

| 檔案 | 修改內容 |
|------|---------|
| `TranslationActivityAttributes.swift` | 新增待機狀態欄位 |
| `TranslationLiveActivityWidget.swift` | 加入點擊區域與 Deep Link |
| `LiveActivityManager.swift` | 新增常駐模式、待機狀態管理 |
| `lingo_journeyApp.swift` | 處理 Deep Link，執行剪貼簿翻譯 |
| `SettingsView.swift` | 新增「常駐動態島」開關 |

### 資料儲存

```swift
// UserDefaults
"persistentLiveActivityEnabled": Bool  // 是否開啟常駐
"lastSourceLanguage": String           // 上次來源語言（已存在）
"lastTargetLanguage": String           // 上次目標語言（已存在）
```

## 動態島 UI 設計

### 狀態定義

| 狀態 | 顯示內容 |
|------|---------|
| 待機 | 翻譯圖示 + 「點擊翻譯」提示 |
| 翻譯中 | 載入動畫 |
| 完成 | 翻譯結果（最多 2 行） |

### Compact 模式（待機）

```
┌──────────────────────────────────┐
│  💬  │              │  點擊翻譯  │
└──────────────────────────────────┘
  左側      動態島        右側
```

### 展開模式（翻譯完成）

```
┌────────────────────────────────────┐
│  中文              →         English │
├────────────────────────────────────┤
│           Hello World              │
├────────────────────────────────────┤
│           你好世界                  │
└────────────────────────────────────┘
```

## 錯誤處理

| 情況 | 處理方式 |
|------|---------|
| 剪貼簿是空的 | 動態島顯示「剪貼簿無內容」，2 秒後恢復待機 |
| 剪貼簿是圖片/檔案 | 動態島顯示「僅支援文字」，2 秒後恢復待機 |
| 翻譯失敗 | 動態島顯示「翻譯失敗」，2 秒後恢復待機 |
| 文字過長（>500 字） | 截取前 500 字翻譯，結果後加「...」 |
| App 被系統終止 | Live Activity 保留，點擊時重新啟動 App |

## 設定頁面

### UI 設計

```
┌─────────────────────────────────────┐
│ 快速翻譯                            │
├─────────────────────────────────────┤
│ 常駐動態島                  [開關]  │
│ 在動態島顯示翻譯快捷鍵              │
├─────────────────────────────────────┤
│ 💡 開啟後，點擊動態島可快速翻譯     │
│    剪貼簿中的文字                   │
└─────────────────────────────────────┘
```

### 開關行為

| 動作 | 結果 |
|------|------|
| 開啟開關 | 立即啟動常駐 Live Activity |
| 關閉開關 | 立即結束 Live Activity |
| App 重新啟動 | 檢查開關狀態，若開啟則自動恢復常駐 |

## 隱私考量

iOS 14+ 讀取剪貼簿時會顯示系統提示（「已從 XXX 貼上」）。這是系統行為，無法避免，但用戶是主動點擊觸發的，屬於預期行為。

## 實作順序

1. 修改 `TranslationActivityAttributes` 加入待機狀態
2. 更新 `TranslationLiveActivityWidget` UI 和點擊處理
3. 擴展 `LiveActivityManager` 支援常駐模式
4. 在 `lingo_journeyApp` 處理 Deep Link
5. 在設定頁面新增開關
6. 測試完整流程
