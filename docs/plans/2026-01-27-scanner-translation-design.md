# 掃描翻譯功能設計

> 日期：2026-01-27
> 狀態：待實作

## 功能概述

在翻譯 Tab 新增相機掃描翻譯功能，讓使用者可以在旅行時即時掃描菜單、路標等文字並獲得翻譯。

## 核心決策

| 項目 | 決定 | 理由 |
|------|------|------|
| 技術方案 | DataScannerViewController (iOS 16+) | Apple 原生框架，內建 UI，開發成本低 |
| 互動模式 | 混合模式 | 預設顯示全部翻譯，也可點選單一區塊細看 |
| 結果呈現 | 底部可拖曳面板 | 符合 iOS 設計規範，可同時看原文和翻譯 |
| 功能入口 | 翻譯 Tab 新增相機按鈕 | 概念一致（都是翻譯），保持 4 個 Tab 簡潔 |
| 歷史記錄 | 自動存文字，不存圖片 | 省空間，跟現有系統一致 |
| iOS 版本 | iOS 16+ | 使用最新框架，簡化開發 |

## 使用者流程

```
翻譯 Tab → 點擊相機按鈕 → 檢查權限 → 開啟掃描畫面
                                         ↓
                              即時偵測文字並翻譯
                                         ↓
                              底部面板顯示翻譯結果
                                         ↓
                              關閉時自動存入歷史
```

## 畫面設計

### 翻譯 Tab（修改後）

```
┌─────────────────────────────────────────┐
│  [中文]  ⇄  [英文]                      │
├─────────────────────────────────────────┤
│                                         │
│   輸入要翻譯的文字...                    │
│                                         │
│                       ┌────┐  ┌────┐    │
│                       │ 📷 │  │ 🎤 │    │
│                       └────┘  └────┘    │
└─────────────────────────────────────────┘
```

### 掃描畫面

```
┌─────────────────────────────────────────┐
│ ← 關閉                    [中文 → 英文] │
├─────────────────────────────────────────┤
│                                         │
│         ┌─────────────────┐             │
│         │ Menu du jour    │ ← 高亮框    │
│         └─────────────────┘             │
│                                         │
│              相機預覽區                  │
│                                         │
├─────────────────────────────────────────┤
│  ════════════ ═ ════════════            │
│                                         │
│  偵測到 3 段文字                         │
│  ─────────────────────────────────────  │
│  ┌─────────────────────────────────┐    │
│  │ Menu du jour                    │    │
│  │ 今日菜單                    📋  │    │
│  └─────────────────────────────────┘    │
│                                         │
└─────────────────────────────────────────┘
```

## 設計規格

### 色彩（延續現有）

| 用途 | 色碼 |
|------|------|
| 背景 | `#0A1628` (appBackground) |
| 表面 | `#0F2744` (appSurface) |
| 高亮表面 | `#162D4A` (appSurfaceElevated) |
| 主色 | `#4A9EFF` (appPrimary) |
| 文字主要 | `#FFFFFF` (appTextPrimary) |
| 文字次要 | `#8E9BAE` (appTextSecondary) |
| 邊框 | `#1E3A5F` (appBorder) |

### 新增元素

| 元素 | 樣式 |
|------|------|
| 掃描高亮框 | appPrimary 描邊 2px、圓角 8px |
| 底部面板 | appSurface、頂部圓角 20px |
| 拖曳條 | 36x4px、appTextMuted、圓角 full |

### 元件規格

| 元件 | 規格 |
|------|------|
| 頂部導航列 | 高度 56px、appSurface 透明度 0.9、blur |
| 關閉按鈕 | SF Symbol `xmark`、44x44px |
| 相機按鈕 | SF Symbol `camera.viewfinder`、44x44px |
| 翻譯卡片 | appSurfaceElevated、圓角 12px、padding 16px |
| 複製按鈕 | SF Symbol `doc.on.doc`、44x44px |

### 面板高度狀態

| 狀態 | 高度 | 觸發 |
|------|------|------|
| 收起 | 120px | 向下滑動 |
| 半開 | 40% 螢幕 | 預設 |
| 全開 | 85% 螢幕 | 向上滑動 |

## 狀態設計

| 狀態 | 畫面表現 | 面板顯示 |
|------|----------|----------|
| 初始化中 | 相機啟動中 | 「正在啟動相機...」+ spinner |
| 掃描中 | 即時預覽 | 「將相機對準文字」 |
| 偵測到文字 | 高亮框出現 | 「偵測到 N 段文字」+ 列表 |
| 翻譯中 | 高亮框閃爍 | skeleton 載入 |
| 翻譯完成 | 高亮框穩定 | 原文 + 翻譯 |
| 無文字 | 無高亮框 | 「未偵測到文字」 |
| 錯誤 | 相機預覽 | 錯誤訊息 + 重試 |

## 互動設計

| 操作 | 回饋 |
|------|------|
| 點擊相機畫面文字 | 高亮框變亮 + 面板滾動到對應翻譯 |
| 點擊面板翻譯項 | 相機高亮對應原文 |
| 點擊複製按鈕 | 複製文字 + 顯示 ✓ |
| 長按翻譯項 | 選單：複製原文/翻譯/收藏 |
| 關閉畫面 | 自動存入歷史 |

## 動畫規格

| 動畫 | 時長 | 曲線 |
|------|------|------|
| 高亮框出現 | 200ms | easeOut |
| 面板滑動 | 300ms | spring |
| 翻譯項淡入 | 150ms | easeIn |
| 複製成功 | 1000ms | 顯示後淡出 |

## 檔案結構

### 新增檔案

```
lingo_journey/
├── Core/
│   └── Services/
│       └── TextRecognitionService.swift    # 封裝 DataScannerViewController
├── Features/
│   └── Scanner/
│       ├── ScannerView.swift               # 掃描畫面主視圖
│       └── ScannerViewModel.swift          # 掃描邏輯與狀態
└── DesignSystem/
    └── Components/
        ├── ScanResultCard.swift            # 翻譯結果卡片
        └── DraggablePanel.swift            # 可拖曳底部面板
```

### 修改檔案

| 檔案 | 修改內容 |
|------|----------|
| `TranslationInputCard.swift` | 新增 `onCameraTap` callback 和相機按鈕 |
| `TranslationView.swift` | 處理相機按鈕點擊，開啟掃描 sheet |

## 權限處理

1. 點擊相機按鈕時檢查 `AVCaptureDevice.authorizationStatus`
2. 未授權則請求權限
3. 拒絕時顯示引導卡片，提示使用者到設定開啟

## 技術要點

### DataScannerViewController 設定

```swift
let configuration = DataScannerViewController.RecognizedDataType.text(
    languages: [sourceLanguage.code]
)
```

### 翻譯整合

使用現有的 Translation Framework，透過 `TranslationService` 進行翻譯。

### 歷史記錄整合

關閉掃描畫面時，將所有翻譯結果以 `TranslationRecord` 存入 SwiftData。

## UX 檢查清單

- [ ] 所有按鈕最小 44x44px
- [ ] 按鈕間距最小 8px
- [ ] 載入時顯示 skeleton/spinner
- [ ] 動畫 150-300ms
- [ ] 支援 prefers-reduced-motion
- [ ] 相機權限拒絕時有清楚引導
